<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>گروه کامپیوتر</title>
    <!-- Bootstrap RTL CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.rtl.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    <script src="/js/fech-warper.js"></script>

    <style>
   
        @font-face {
            font-family: peyda;
            src: url("/font/PeydaWeb-Regular.woff2");
        }
        html, body, * , *::before, *::after {
            font-family: peyda, sans-serif !important;
        }
        h1, h2, h3, h4, h5, h6, p, a, button, input, textarea, label, ul, ol, li, span, div {
            font-family: peyda, sans-serif !important;
        }
        body { background: #f8fafc; }
        .hero-section { background: linear-gradient(120deg, #e0e7ff 0%, #f8fafc 100%); padding: 3rem 0 2rem 0; }
        .section-title { font-weight: bold; margin-bottom: 2rem; color: #2d3a4b; }
        .feature-card { border: none; border-radius: 1rem; box-shadow: 0 2px 12px #0001; transition: transform 0.2s; }
        .feature-card:hover { transform: translateY(-6px) scale(1.03); }
        .news-card { border-radius: 1rem; box-shadow: 0 2px 8px #0001; }
        .edu-card { border-radius: 1rem; box-shadow: 0 2px 8px #0001; }
        .footer { background: #2d3a4b; color: #fff; padding: 2rem 0 1rem 0; }
        .footer a { color: #fff; text-decoration: underline; }
        .slider-img { object-fit: cover; height: 340px; border-radius: 1rem; }
        .navbar-brand { font-weight: bold; font-size: 1.5rem; }
    </style>
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm sticky-top">
        <div class="container">
            <a class="navbar-brand" href="/">گروه کامپیوتر</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="تغییر منو">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item"><a class="nav-link active" href="/">خانه</a></li>
                    <li class="nav-item"><a class="nav-link" href="/courses">دوره‌ها و رویدادها</a></li>
                    <li class="nav-item"><a class="nav-link" href="/news">اخباراطلاعیه ها</a></li>
                    <li class="nav-item dropdown"><a class="nav-link" href="/tranning">آموزشی</a></li>
                    <li class="nav-item"><a class="nav-link" href="/community">انجمن</a></li>
                    <li class="nav-item"><a class="nav-link" href="/teachers">اساتید</a></li>
                </ul>
                <div id="auth-section" class="d-none d-lg-inline">
                    <!-- Login button (shown when not logged in) -->
                    <a href="/login" class="btn btn-primary ms-3" id="login-btn">ورود</a>
                    
                    <!-- User info (shown when logged in) -->
                    <div class="dropdown ms-3" id="user-info" style="display: none;">
                        <button class="btn btn-outline-primary dropdown-toggle" type="button" id="userDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                            <i class="bi bi-person-circle me-2"></i>
                            <span id="user-name">کاربر</span>
                        </button>
                        <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="userDropdown">
                            <li><span class="dropdown-item-text text-muted" id="user-type">نوع کاربر</span></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item" href="#" onclick="logout()">
                                <i class="bi bi-box-arrow-right me-2"></i>خروج
                            </a></li>
                        </ul>
                    </div>
                </div>
                
                <!-- Mobile version -->
                <div class="d-lg-none">
                    <a href="/login" class="btn btn-primary w-100 mt-2" id="login-btn-mobile">ورود</a>
                    <div id="user-info-mobile" style="display: none;" class="mt-2">
                        <div class="d-flex align-items-center justify-content-between p-2 bg-light rounded">
                            <div>
                                <i class="bi bi-person-circle me-2"></i>
                                <span id="user-name-mobile">کاربر</span>
                                <small class="text-muted d-block" id="user-type-mobile">نوع کاربر</small>
                            </div>
                            <button class="btn btn-sm btn-outline-danger" onclick="logout()">
                                <i class="bi bi-box-arrow-right"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Hero Section with Slider -->
    <%- include('./selection/picGallery.ejs')%>

    <!-- Courses & Events Section -->
    <%- include('./selection/curses.ejs')%>

    <!-- News & Announcements Section -->
    <%- include('./selection/news.ejs')%>

    <!-- Educational Section -->
    <%- include('./selection/tranning.ejs')%>

    <!-- Community Section -->
    <section class="py-5 bg-light" id="community">
        <div class="container">
            <h2 class="section-title text-center">انجمن</h2>
            <div class="row g-4 justify-content-center">
                <div class="col-md-8">
                    <div class="card feature-card h-100 text-center p-4">
                        <i class="bi bi-chat-dots display-4 text-secondary mb-3"></i>
                        <h5 class="fw-bold mb-2">انجمن گفتگو و همکاری</h5>
                        <p class="text-muted">محیطی برای تبادل نظر، پرسش و پاسخ و همکاری دانشجویان و اساتید در موضوعات مختلف حوزه کامپیوتر.</p>
                        <div class="text-center mt-3">
                            <a href="/community" class="btn btn-outline-secondary">مشاهده کامل انجمن</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Teachers Section -->
    <%- include('./selection/teachers.ejs')%>

    <!-- Footer -->
    <footer class="footer mt-5" id="contact">
        <div class="container">
            <div class="row">
                <div class="col-md-6 mb-3 mb-md-0" id="university-info">
                    <h5 class="fw-bold mb-2" id="universityName">گروه کامپیوتر</h5>
                    <p class="mb-1" id="universityDetails">دانشگاه ... | سال تاسیس: ۱۳۸۰</p>
                    <p class="mb-1" id="universityPhone">تلفن: ۰۲۱-۱۲۳۴۵۶۷۸</p>
                    <p class="mb-0" id="universityDescription">توضیحات: ...</p>
                </div>
                <div class="col-md-6 text-md-end">
                    <h6 class="fw-bold mb-2">لینک‌های مفید</h6>
                    <ul class="list-unstyled">
                        <li><a href="/">خانه</a></li>
                        <li><a href="/courses">دوره‌ها و رویدادها</a></li>
                        <li><a href="/news">اخبار و اطلاعیه ها</a></li>
                        <li><a href="/tranning">آموزشی</a></li>
                        <li><a href="/community">انجمن</a></li>
                        <li><a href="/teachers">اساتید</a></li>
                    </ul>
                </div>
            </div>
            <hr class="my-4" style="border-color: #fff3;">
            <div class="text-center small">© ۱۴۰۳ گروه کامپیوتر - تمامی حقوق محفوظ است.</div>
        </div>
    </footer>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Authentication Script -->
    <script>
        // Prevent duplicate execution
        if (!window.authInitialized) {
            window.authInitialized = true;
            
            // Check authentication status on page load
            document.addEventListener('DOMContentLoaded', function() {
                setTimeout(checkAuthStatus, 100);
            });

            // Check if user is authenticated
            async function checkAuthStatus() {
                try {
                    const response = await fetch('/api/auth/me');
                    const result = await response.json();
                    
                    if (result.success && result.data.user) {
                        showUserInfo(result.data.user);
                    } else {
                        showLoginButton();
                    }
                } catch (error) {
                    console.error('خطا در بررسی وضعیت احراز هویت:', error);
                    showLoginButton();
                }
            }

            // Show user information
            function showUserInfo(user) {
                const userName = `${user.firstName} ${user.lastName}`;
                const userType = user.type === 'teacher' ? 'استاد' : 'دانشجو';
                
                // Desktop version
                const loginBtn = document.getElementById('login-btn');
                const userInfo = document.getElementById('user-info');
                const userNameEl = document.getElementById('user-name');
                const userTypeEl = document.getElementById('user-type');
                
                if (loginBtn) loginBtn.style.display = 'none';
                if (userInfo) userInfo.style.display = 'block';
                if (userNameEl) userNameEl.textContent = userName;
                if (userTypeEl) userTypeEl.textContent = userType;
                
                // Mobile version
                const loginBtnMobile = document.getElementById('login-btn-mobile');
                const userInfoMobile = document.getElementById('user-info-mobile');
                const userNameMobile = document.getElementById('user-name-mobile');
                const userTypeMobile = document.getElementById('user-type-mobile');
                
                if (loginBtnMobile) loginBtnMobile.style.display = 'none';
                if (userInfoMobile) userInfoMobile.style.display = 'block';
                if (userNameMobile) userNameMobile.textContent = userName;
                if (userTypeMobile) userTypeMobile.textContent = userType;
            }

            // Show login button
            function showLoginButton() {
                // Desktop version
                const loginBtn = document.getElementById('login-btn');
                const userInfo = document.getElementById('user-info');
                
                if (loginBtn) loginBtn.style.display = 'inline-block';
                if (userInfo) userInfo.style.display = 'none';
                
                // Mobile version
                const loginBtnMobile = document.getElementById('login-btn-mobile');
                const userInfoMobile = document.getElementById('user-info-mobile');
                
                if (loginBtnMobile) loginBtnMobile.style.display = 'block';
                if (userInfoMobile) userInfoMobile.style.display = 'none';
            }

            // Logout function
            window.logout = async function() {
                try {
                    const response = await fetch('/api/auth/logout', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        }
                    });
                    
                    const result = await response.json();
                    
                    if (result.success) {
                        // Show success message
                        showMessage('خروج موفقیت‌آمیز بود', 'success');
                        
                        // Refresh page after 1 second
                        setTimeout(() => {
                            window.location.reload();
                        }, 1000);
                    } else {
                        showMessage('خطا در خروج از سیستم', 'error');
                    }
                } catch (error) {
                    console.error('خطا در خروج:', error);
                    showMessage('خطا در اتصال به سرور', 'error');
                }
            }

            // Show message function
            function showMessage(message, type) {
                const alertDiv = document.createElement('div');
                alertDiv.className = `alert alert-${type === 'success' ? 'success' : 'danger'} alert-dismissible fade show position-fixed`;
                alertDiv.style.cssText = 'top: 20px; right: 20px; z-index: 9999; min-width: 300px;';
                alertDiv.innerHTML = `
                    ${message}
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                `;
                
                document.body.appendChild(alertDiv);
                
                // Auto remove after 3 seconds
                setTimeout(() => {
                    if (alertDiv.parentNode) {
                        alertDiv.remove();
                    }
                }, 3000);
            }
        }
    </script>
    <script>
    document.addEventListener('DOMContentLoaded', async function() {
        try {
            const response = await fetch('http://localhost:5000/api/settings');
            const result = await response.json();
            if(result.success && result.data) {
                document.getElementById('universityName').textContent = result.data.universityName || 'گروه کامپیوتر';
                document.getElementById('universityDetails').textContent = (result.data.universityName ? result.data.universityName + ' | ' : '') + (result.data.establishedYear ? 'سال تاسیس: ' + result.data.establishedYear : '');
                document.getElementById('universityPhone').textContent = 'تلفن: ' + (result.data.phone || '---');
                document.getElementById('universityDescription').textContent = result.data.description || result.data.about || '';
            }
        } catch (e) {
            // Silent fail
        }
    });
    </script>
</body>
</html>

